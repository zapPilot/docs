---
sidebar_position: 2
---

# 🔬 Zap Pilotが資金を割り当てる方法

Zap
Pilotは、複数のDeFiプロトコルにユーザーの資金を割り当てるための基礎として**ケリー基準**を使用しています。元のケリーの式は本質的に数学的ですが、私たちの実装には、オンチェーン資産管理に適したものにするための現実世界のリスク修飾子が含まれています。

このページでは、ボールトの割り当てを計算し、オンチェーンのリスク、流動性、プロトコルの成熟度を反映するように生のケリーの出力を調整する方法について説明します。

---

## 🔍 1. ケリー基準とは？

The Kelly
Criterionは、リターンとリスクのバランスをとることで長期的な資本成長を最大化するポジションサイジング戦略です。ギャンブルとポートフォリオ理論の両方で広く使用されています。

### 📐 基本的な式：

```python
allocation_weight = expected_return / variance
```

Zap
Pilotでは、各DeFiプールを期待APYとリスクプロファイルを持つ「賭け」として扱います。リターンが高く、ボラティリティが低いほど、より多くの資本を割り当てる価値があります。

---

## ⚙️ 2. 実践におけるケリー基準

ボールト内のすべての適格なプールに、ケリーの式の簡略化および正規化されたバージョンを適用します。

### ステップバイステップのプロセス：

#### 🔢 入力メトリクス（プールごと）：

- 推定年間リターン（APY）
- リスク推定（分散、APY履歴またはモデリングに基づく）

#### 🧮 生の重みを計算：

```python
raw_weight = apy / variance
```

#### 📊 重みを正規化：

すべての最終的な重みの合計が1になるようにします：

```python
normalized_weight = raw_weight / sum(raw_weights)
```

#### 🚫 後処理フィルター：

- **負の重み**を持つプールは除外されます
- **非常に小さい重み**（例：<
  1%）を持つプールは、ガス代のオーバーヘッドとダスト割り当てを削減するために除外される場合があります

👉 完全な実装：GitHubの`kelly_allocation.py`

---

## 🧱 3. 現実世界の調整：リスク修飾子

ケリーの式は数学的に健全ですが、DeFiには追加の注意が必要です。Zap
Pilotは、現実世界の安全性と信頼性を向上させるために**リスク修飾子**を統合しています。

### 📦 TVL（ロックされた総価値）

- **非常に低いTVL**を持つプールは除外または上限が設定される場合があります
- **なぜ？** 低いTVLは、流動性の低さ、スリッページの高さ、または市場の信頼性の低さを意味します

### 🕰 プロトコルの年齢

- 新しく立ち上げられたプロトコル（例：< 3ヶ月）は保守的に扱われます
- **なぜ？** 高いAPYは、監査、セキュリティ、またはユーザーベースの欠如を補うものではありません

### 💡 これらを適用する方法：

- **フィルター：** 最小TVLまたは年齢のしきい値を下回るプールを削除
- **乗数：** リスクの高いプールは部分的な割り当てを受ける場合があります（例：50%の重み削減）
- **境界：** 各プールの上限/下限を設定

これらの調整により、ケリーベースのロジックが**DeFi固有の信頼と安全性の懸念**を反映することが保証されます。

---

## 📊 4. サンプル出力

**ステーブルコインボールト**のケリー加重割り当てのサンプルは次のようになります：

```
Aave USDC (Optimism):        35%
Pendle sDAI (Arbitrum):      42%
Compound USDT (Ethereum):    23%
```

ユーザーがザップインすると、資金は自動的に分割され、このポートフォリオに一致するようにブリッジされます。

---

## 🔁 5. リバランスモデル

- **頻度：** 割り当ては四半期ごとに再計算されます
- **通知：** ユーザーには更新された戦略の提案がメールで送信されます
- **実行：**
  ユーザーはフロントエンドを介してワンクリックでリバランスできます（すべてのアクションは非管理型であり、ユーザーのAAウォレットから署名されます）

---

## 🚀 6. 今後の改善

より多くの入力と柔軟性を備えた割り当てエンジンを拡張しています：

- オフチェーンオラクルフィード（APY、ボラティリティ）
- ガバナンス、トークノミクス、コード監査に基づくリスクスコアリング
- ユーザー定義のケリー曲線（パーソナライズされたリスクプロファイル）
- ボールト固有のオーバーライド（例：資本上限、スリッページモデリング）

---

## ✅ まとめ

Zap
Pilotは、ケリー基準を厳格な式としてではなく、DeFi向けの**動的でリスクを意識した割り当てエンジン**として使用しています。リターンとリスクの最適化を**TVL**や**プロトコルの成熟度**などの現実世界のフィルターと組み合わせることで、不要なエクスポージャーを最小限に抑えながら、**堅牢で長期的な成長**を実現することを目指しています。
