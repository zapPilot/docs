---
sidebar_position: 4
---

# プロトコルメカニクス

Zap
Pilotは、洗練されたノンカストディアルアルゴリズム資産配分システムとして機能します。ここでは、プロトコルメカニクスがどのように動作するかを詳しく説明します。

## システムアーキテクチャ

### ノンカストディアル設計

Zap Pilotは基本的な原則に基づいて構築されています：**あなたは常に自分の資金をコントロールします**。

- **カストディなし**：私たちはあなたの資産を預かりません
- **直接プロトコル相互作用**：あなたのウォレットはDeFiプロトコルと直接やり取りします
- **透明な実行**：すべての操作はオンチェーンで監査可能です
- **緊急出口**：必要に応じてプロトコルから直接引き出すことができます

## Vault ロジック

### テーマ別Vault構造

各Vaultは、キュレーションされたDeFiプロトコルを持つ特定の投資戦略を表します：

#### **Vault コンポーネント**

- **戦略定義**：明確な投資論理とターゲット配分
- **プロトコルホワイトリスト**：セキュリティ基準を満たす検証済み・監査済みプロトコル
- **リスクパラメーター**：プロトコルごとの最大配分限度
- **リバランシングルール**：ポートフォリオ調整をトリガーする条件

#### **動的重み付けシステム**

各Vault内のプロトコルは以下に基づいて重み付けされます：

```
プロトコル重み = ベース重み × パフォーマンス乗数 × リスク調整
```

**ベース重み要因：**

- Total Value Locked (TVL) - ステーブルコイン戦略で最低$300k
- 監査履歴とセキュリティスコア
- 過去の利回り安定性
- 流動性の深さ

**パフォーマンス乗数：**

- 最近の利回りパフォーマンス vs ベンチマーク
- 時間を通じた利回りの一貫性
- プロトコルガバナンスの健全性

**リスク調整：**

- スマートコントラクトリスク評価
- ガバナンストークンの集中度
- プロトコルの年数と実戦テスト期間

### 戦略実行フロー

1. **ユーザー入金** → Account Abstraction ウォレットが資金を受け取る
2. **Vault ルーティング** → 適切なテーマVaultに資金を振り分け
3. **プロトコル配分** → キュレーションされたプロトコルに資産を配分
4. **継続監視** → リアルタイムパフォーマンスとリスク追跡
5. **リバランシングトリガー** → 四半期提案または閾値ベースアラート

## Kelly Allocation Strategy

### 数学的基盤

私たちは**Kelly
Criterion**を使用して最適なポジションサイズを決定し、リスクを管理しながら長期的な幾何成長を最大化します。

#### **Kelly公式**

```
最適重み = (期待リターン - リスクフリーレート) / 分散
```

#### **マルチアセットKelly配分**

複数の資産を含むポートフォリオの場合：

```
W* = Σ⁻¹ × (μ - rf × 1)
```

ここで：

- **W\*** = 最適重みベクトル
- **Σ⁻¹** = リターンの逆共分散行列
- **μ** = 期待リターンベクトル
- **rf** = リスクフリーレート
- **1** = 1のベクトル

### 実用的実装

#### **リスク調整Kelly**

従来のKelly公式を修正して以下を考慮します：

- **最大ドローダウン限度**（保守的15%、積極的30%）
- **相関制約**（相関資産に最大60%）
- **流動性要件**（10%を流動的ポジションに保持）

#### **動的リバランシングトリガー**

リバランシングは以下の場合に発生します：

- **配分ドリフト** > ターゲット重みから5%
- **リスクメトリクス**が事前定義された閾値を超える
- **新機会**でリスク調整後リターンが大幅に改善される
- **四半期レビュー**（ドリフトに関係なく、ユーザー設定可能）

## Account Abstraction統合

### ウォレットアーキテクチャ

#### **スマートウォレット機能**

- **ガスレストランザクション**（メタトランザクション経由）
- **バッチ操作**（ガス効率のため）
- **セッションキー**（自動化戦略用）
- **マルチシグサポート**（機関投資家向け）

#### **ユーザーエクスペリエンス利点**

**初心者向け：**

- 複数チェーンでガス用ETHを保持する必要なし
- ワンクリック複雑操作
- ソーシャルリカバリーオプション

**上級者向け：**

- プログラム可能なトランザクションロジック
- 自動リバランシング権限
- カスタム支出制御

### トランザクションバッチング

複数の操作を単一トランザクションに結合：

```
バッチトランザクション = [
  approve(token, amount),
  deposit(vault, amount),
  distribute(protocols[], weights[]),
  track(performance_metrics)
]
```

## リスク管理フレームワーク

### プロトコルレベルセーフガード

#### **自動リスク監視**

- **TVL閾値**：最低流動性要件
- **利回り異常検出**：異常に高い/低いリターンにフラグ
- **ガバナンスリスク評価**：プロトコル変更の監視
- **スマートコントラクト監視**：アップグレードイベントの追跡

#### **分散化制約**

- **単一プロトコル最大配分**：保守的30%、積極的50%
- **アセットタイプ分散**：単一アセットクラスに70%以下
- **チェーン分散**：複数ネットワークにリスク分散

### ユーザーレベルコントロール

#### **リスク許容度設定**

- **保守的**：低ボラティリティ、安定プロトコルのみ
- **中程度**：バランスのとれたリスク/リワード、確立されたプロトコル
- **積極的**：高リスク許容度、新しいプロトコルを含む

#### **緊急手順**

- **即時引き出し**：直接プロトコル相互作用
- **リスクオフモード**：危機時に自動的に安全な資産に移動
- **サーキットブレーカー**：極端なボラティリティ時に自動化アクションを停止

## リバランシングメカニクス

### トリガー条件

#### **閾値ベースリバランシング**

- 配分ドリフトがターゲットを5%超過
- リスクメトリクスが事前定義限度を突破
- > 2%の利点を持つ利回り機会が発生

#### **時間ベースリバランシング**

- **週次**：アクティブ戦略用（オプション、高コスト）
- **月次**：標準頻度（推奨）
- **四半期**：メール提案による低コストアプローチ

### 実行プロセス

1. **分析フェーズ**
   - 現在vs目標配分を計算
   - ガスコストvs リバランシング利益を評価
   - 最適実行パスを特定

2. **ユーザー承認**
   - リバランシング提案を提示
   - 推定コストと利益を表示
   - 手動レビューと修正を許可

3. **実行フェーズ**
   - ガス効率のためのバッチトランザクション
   - 必要に応じて複数チェーンで実行
   - 追跡とアナリティクスを更新

## パフォーマンスアトリビューション

### リアルタイムアナリティクス

以下からのパフォーマンス寄与を追跡：

- **プロトコル選択**：どのプロトコルがリターンを牽引したか
- **配分タイミング**：リバランシング決定の影響
- **チェーン最適化**：クロスチェーン戦略の利益
- **コスト管理**：ガス効率と手数料最適化

### ベンチマーク比較

戦略パフォーマンスを以下と比較：

- **市場指数**：Bitcoin、Ethereum、DeFi指数
- **伝統的金融**：S&P 500、債券指数
- **DeFi ベンチマーク**：プロトコル固有リターン
- **リスク調整メトリクス**：Sharpe比、Sortino比

---

これらのメカニクスを理解することで、DeFi戦略について十分な情報に基づいた決定を下すことができます。私たちのシステムは複雑さを処理しながら、あなたがコントロールを維持できるようにします。

👉 **[戦略を探索 →](../strategies)** 👉 **[セキュリティ詳細を表示 →](../security)**
