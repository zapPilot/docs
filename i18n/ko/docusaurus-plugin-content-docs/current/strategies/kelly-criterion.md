---
sidebar_position: 2
---

# 🔬 Zap Pilot이 자금을 할당하는 방법

Zap Pilot은 여러 DeFi 프로토콜에 사용자 자금을 할당하기 위한 기초로 **켈리 기준**을 사용합니다. 원래
켈리 공식은 본질적으로 수학적이지만, 우리의 구현에는 온체인 자산 관리에 적합하도록 실제 위험
수정자가 포함되어 있습니다.

이 페이지에서는 금고 할당을 계산하고 온체인 위험, 유동성 및 프로토콜 성숙도를 반영하도록 원시 켈리
출력을 조정하는 방법을 설명합니다.

---

## 🔍 1. 켈리 기준이란?

켈리 기준은 수익과 위험의 균형을 맞춰 장기적인 자본 성장을 극대화하는 포지션 사이징 전략입니다.
도박과 포트폴리오 이론 모두에서 널리 사용됩니다.

### 📐 기본 공식:

```python
allocation_weight = expected_return / variance
```

Zap Pilot에서는 각 DeFi 풀을 예상 APY와 위험 프로필을 가진 "베팅"으로 취급합니다. 수익률이 높고
변동성이 낮을수록 더 많은 자본을 할당할 가치가 있습니다.

---

## ⚙️ 2. 실제 켈리 기준

금고의 모든 적격 풀에 켈리 공식의 단순화되고 정규화된 버전을 적용합니다.

### 단계별 프로세스:

#### 🔢 입력 메트릭(풀당):

- 예상 연간 수익률(APY)
- 위험 추정치(분산, APY 기록 또는 모델링 기반)

#### 🧮 원시 가중치 계산:

```python
raw_weight = apy / variance
```

#### 📊 가중치 정규화:

모든 최종 가중치의 합이 1이 되도록 합니다:

```python
normalized_weight = raw_weight / sum(raw_weights)
```

#### 🚫 후처리 필터:

- **음의 가중치**를 가진 풀은 제외됩니다
- **매우 작은 가중치**(예: < 1%)를 가진 풀은 가스 오버헤드 및 더스트 할당을 줄이기 위해 필터링될 수
  있습니다

👉 전체 구현: GitHub의 `kelly_allocation.py`

---

## 🧱 3. 실제 조정: 위험 수정자

켈리 공식은 수학적으로 건전하지만 DeFi에는 추가적인 주의가 필요합니다. Zap Pilot은 실제 안전성과
신뢰성을 향상시키기 위해 **위험 수정자**를 통합합니다.

### 📦 TVL(총 고정 가치)

- **매우 낮은 TVL**을 가진 풀은 제외되거나 상한선이 설정될 수 있습니다
- **이유는?** 낮은 TVL은 유동성 부족, 높은 슬리피지 또는 낮은 시장 신뢰를 의미합니다

### 🕰 프로토콜 연령

- 새로 출시된 프로토콜(예: < 3개월)은 보수적으로 처리됩니다
- **이유는?** 높은 APY는 감사, 보안 또는 사용자 기반 부족을 보상하지 않습니다

### 💡 적용 방법:

- **필터:** 최소 TVL 또는 연령 임계값 미만의 풀 제거
- **승수:** 위험한 풀은 부분 할당을 받을 수 있습니다(예: 50% 가중치 감소)
- **경계:** 각 풀에 대한 상한/하한 설정

이러한 조정은 켈리 기반 논리가 **DeFi 관련 신뢰 및 안전 문제**를 반영하도록 보장합니다.

---

## 📊 4. 샘플 출력

**스테이블코인 금고**에 대한 샘플 켈리 가중 할당은 다음과 같을 수 있습니다:

```
Aave USDC (Optimism):        35%
Pendle sDAI (Arbitrum):      42%
Compound USDT (Ethereum):    23%
```

사용자가 잽인하면 자금이 자동으로 분할되어 이 포트폴리오와 일치하도록 브리징됩니다.

---

## 🔁 5. 리밸런싱 모델

- **빈도:** 할당은 분기별로 재계산됩니다
- **알림:** 사용자에게 업데이트된 전략 제안이 이메일로 전송됩니다
- **실행:** 사용자는 프런트엔드를 통해 원클릭으로 리밸런싱할 수 있습니다 (모든 작업은 비수탁이며
  사용자의 AA 지갑에서 서명됩니다)

---

## 🚀 6. 향후 개선 사항

더 많은 입력과 유연성으로 할당 엔진을 확장하고 있습니다:

- 오프체인 오라클 피드(APY, 변동성)
- 거버넌스, 토크노믹스 및 코드 감사를 기반으로 한 위험 점수화
- 사용자 정의 켈리 곡선(개인화된 위험 프로필)
- 금고별 재정의(예: 자본 상한, 슬리피지 모델링)

---

## ✅ 요약

Zap Pilot은 켈리 기준을 엄격한 공식이 아니라 DeFi를 위한 **동적이고 위험을 인식하는 할당 엔진**으로
사용합니다. 수익-위험 최적화와 **TVL** 및 **프로토콜 성숙도**와 같은 실제 필터를 결합하여 불필요한
노출을 최소화하면서 **견고하고 장기적인 성장**을 제공하는 것을 목표로 합니다.
